<div class="article-intro" id="content">
<h1>AJAX - 向服务器发送请求<span class="color_h1">请求</span></h1>
<hr/>
<p class="intro">XMLHttpRequest 对象用于和服务器交换数据。</p>
<hr/>
<h2>向服务器发送请求</h2>
<p>如需将请求发送到服务器，我们使用 XMLHttpRequest 对象的 open() 和 send() 方法：</p>
<div class="code"><div>
xmlhttp.open("GET","ajax_info.txt",true);<br/>
xmlhttp.send();</div></div>
<br/><table class="reference">
<tbody><tr>
<th style="width:40%;">方法</th>
<th>描述</th>
</tr>
<tr>
<td>open(<i>method</i>,<i>url</i>,<i>async</i>)</td>
<td>
<p>规定请求的类型、URL 以及是否异步处理请求。</p>
<ul class="listintable">
<li><i>method</i>：请求的类型；GET 或 POST</li>
<li><i>url</i>：文件在服务器上的位置</li>
<li><i>async</i>：true（异步）或 false（同步）</li>
</ul>
</td>
</tr>
<tr>
<td>send(<i>string</i>)</td>
<td>
<p>将请求发送到服务器。</p>
<ul class="listintable">
<li><i>string</i>：仅用于 POST 请求</li>
</ul>
</td>
</tr>
</tbody></table>
<br/><hr/>
<h2>GET 还是 POST？</h2>
<p>与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用。</p>
<p>然而，在以下情况中，请使用 POST 请求：</p>
<ul>
<li>无法使用缓存文件（更新服务器上的文件或数据库）</li>
<li>向服务器发送大量数据（POST 没有数据量限制）</li>
<li>发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠</li>
</ul>
<hr/>
<h2>GET 请求</h2>
<p>一个简单的 GET 请求：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">GET</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">/try/ajax/demo_get.php</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-reserved">true</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryajax_get" target="_blank">尝试一下 »</a>
</div>
<p>在上面的例子中，您可能得到的是缓存的结果。</p>
<p>为了避免这种情况，请向 URL 添加一个唯一的 ID：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">GET</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">/try/ajax/demo_get.php?t=</span><span class="hl-quotes">"</span><span class="hl-code"> + </span><span class="hl-builtin">Math</span><span class="hl-code">.</span><span class="hl-identifier">random</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">,</span><span class="hl-reserved">true</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryajax_get_unique" target="_blank">尝试一下 »</a>
</div>
<p>如果您希望通过 GET 方法发送信息，请向 URL 添加信息：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">GET</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">/try/ajax/demo_get2.php?fname=Henry&amp;lname=Ford</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-reserved">true</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryajax_get2" target="_blank">尝试一下 »</a>
</div>
<br/><hr/>
<h2>POST 请求</h2>
<p>一个简单 POST 请求：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">POST</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">/try/ajax/demo_post.php</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-reserved">true</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryajax_post" target="_blank">尝试一下 »</a>
</div>
<p>如果需要像 HTML 表单那样 POST 数据，请使用 setRequestHeader() 来添加 HTTP 头。然后在 send() 方法中规定您希望发送的数据：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">POST</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">/try/ajax/demo_post2.php</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-reserved">true</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">setRequestHeader</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">Content-type</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">application/x-www-form-urlencoded</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">fname=Henry&amp;lname=Ford</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryajax_post2" target="_blank">尝试一下 »</a>
</div>
<br/><table class="reference">
<tr>
<th align="left" width="40%">方法</th>
<th align="left" width="60%">描述</th>
</tr>
<tr>
<td>setRequestHeader(<i>header,value</i>)</td>
<td>
<p>向请求添加 HTTP 头。</p>
<ul class="listintable">
<li><i>header</i>: 规定头的名称</li>
<li><i>value</i>: 规定头的值</li>
</ul>
</td>
</tr>
</table>
<br/><hr/>
<h2>url - 服务器上的文件</h2>
<p>open() 方法的 <i>url</i> 参数是服务器上文件的地址：</p>
<div class="code notranslate"><div>
xmlhttp.open("GET","ajax_test.html",true);</div></div>
<p>该文件可以是任何类型的文件，比如 .txt 和 .xml，或者服务器脚本文件，比如 .asp 和 .php （在传回响应之前，能够在服务器上执行任务）。</p>
<hr/>
<h2>异步 - True 或 False？</h2>
<p>AJAX 指的是异步 JavaScript 和 XML（Asynchronous JavaScript and XML）。</p>
<p>XMLHttpRequest 对象如果要用于 AJAX 的话，其 open() 方法的 async 参数必须设置为 true：</p>
<div class="code notranslate"><div>
xmlhttp.open("GET","ajax_test.html",true);</div></div>
<p>对于 web 开发人员来说，发送异步请求是一个巨大的进步。很多在服务器执行的任务都相当费时。AJAX 出现之前，这可能会引起应用程序挂起或停止。</p>
<p>通过 AJAX，JavaScript 无需等待服务器的响应，而是：</p>
<ul>
<li>在等待服务器响应时执行其他脚本</li>
<li>当响应就绪后对响应进行处理</li>
</ul>
<hr/>
<h2>Async=true</h2>
<p>当使用 async=true 时，请规定在响应处于 onreadystatechange 事件中的就绪状态时执行的函数：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">onreadystatechange</span><span class="hl-code">=</span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">readyState</span><span class="hl-code">==</span><span class="hl-number">4</span><span class="hl-code"> &amp;&amp; </span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">status</span><span class="hl-code">==</span><span class="hl-number">200</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">myDiv</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">responseText</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">GET</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">/try/ajax/ajax_info.txt</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-reserved">true</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryajax_first" target="_blank">尝试一下 »</a>
</div>
<p>您将在稍后的章节学习更多有关 onreadystatechange 的内容。</p>
<hr/>
<h2>Async = false</h2>
<p>如需使用 async=false，请将 open() 方法中的第三个参数改为 false：</p>
<pre>xmlhttp.open("GET","test1.txt",false);</pre>
<p>我们不推荐使用 async=false，但是对于一些小型的请求，也是可以的。</p>
<p>请记住，JavaScript 会等到服务器响应就绪才继续执行。如果服务器繁忙或缓慢，应用程序会挂起或停止。</p>
<p><b>注意：</b>当您使用 async=false 时，请不要编写 onreadystatechange 函数 - 把代码放到 send() 语句后面即可：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">GET</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">/try/ajax/ajax_info.txt</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-reserved">false</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">myDiv</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">responseText</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryajax_asyncfalse" target="_blank">尝试一下 »</a>
</div>
</div>