<div class="article-intro" id="content">
<h1>Ruby <span class="color_h1">哈希（Hash）</span></h1>
<div class="tutintro">
<p>哈希（Hash）是类似 "key" =&gt; "value" 这样的键值对集合。哈希类似于一个数组，只不过它的索引不局限于使用数字。</p>
<p>Hash 的索引（或者叫"键"）几乎可以是任何对象。</p>
<p>Hash 虽然和数组类似，但却有一个很重要的区别：Hash 的元素没有特定的顺序。 如果顺序很重要的话就要使用数组了。</p>
</div>
<h2 class="tutheader">创建哈希</h2>
<p>与数组一样，有各种不同的方式来创建哈希。您可以通过 <i>new</i> 类方法创建一个空的哈希：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">months</span><span class="hl-code"> = </span><span class="hl-identifier">Hash</span><span class="hl-code">.</span><span class="hl-identifier">new</span></div>
</div>
</div>
<p>您也可以使用 <i>new</i> 创建带有默认值的哈希，不带默认值的哈希是 <i>nil</i>：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">months</span><span class="hl-code"> = </span><span class="hl-identifier">Hash</span><span class="hl-code">.</span><span class="hl-identifier">new</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">month</span><span class="hl-quotes">"</span><span class="hl-code"> </span><span class="hl-brackets">)</span><span class="hl-code">
 
或
 
</span><span class="hl-identifier">months</span><span class="hl-code"> = </span><span class="hl-identifier">Hash</span><span class="hl-code">.</span><span class="hl-identifier">new</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">month</span><span class="hl-quotes">"</span></div>
</div>
</div>
<p>当您访问带有默认值的哈希中的任意键时，如果键或值不存在，访问哈希将返回默认值：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-comment">#</span><span class="hl-comment">!/usr/bin/ruby</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">months</span><span class="hl-code"> = </span><span class="hl-identifier">Hash</span><span class="hl-code">.</span><span class="hl-identifier">new</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">month</span><span class="hl-quotes">"</span><span class="hl-code"> </span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">#{months[0]}</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">#{months[72]}</span><span class="hl-quotes">"</span></div>
</div><br/>
<a class="tryitbtn" href="/try/runcode.php?filename=hashobj_demo&amp;type=ruby" target="_blank">尝试一下 »</a>
</div>
<p>以上实例运行输出结果为：</p>
<pre>
month
month
</pre>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-comment">#</span><span class="hl-comment">!/usr/bin/ruby</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">H</span><span class="hl-code"> = </span><span class="hl-identifier">Hash</span><span class="hl-brackets">[</span><span class="hl-quotes">"</span><span class="hl-string">a</span><span class="hl-quotes">"</span><span class="hl-code"> =&gt; </span><span class="hl-number">100</span><span class="hl-code">, </span><span class="hl-quotes">"</span><span class="hl-string">b</span><span class="hl-quotes">"</span><span class="hl-code"> =&gt; </span><span class="hl-number">200</span><span class="hl-brackets">]</span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">#{H['a']}</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">#{H['b']}</span><span class="hl-quotes">"</span></div>
</div><br/>
<a class="tryitbtn" href="/try/runcode.php?filename=hashobj_demo2&amp;type=ruby" target="_blank">尝试一下 »</a>
</div>
<p>以上实例运行输出结果为：</p>
<pre>
100
200
</pre>
<p>您可以使用任何的 Ruby 对象作为键或值，甚至可以使用数组，如下实例所示：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-brackets">[</span><span class="hl-number">1</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">jan</span><span class="hl-quotes">"</span><span class="hl-brackets">]</span><span class="hl-code"> =&gt; </span><span class="hl-quotes">"</span><span class="hl-string">January</span><span class="hl-quotes">"</span></div>
</div>
</div>
<h2 class="tutheader">哈希内置方法</h2>
<p>如果需要调用 Hash 方法，需要先实例化一个 Hash 对象。下面是创建 Hash 对象实例的方式：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">Hash</span><span class="hl-brackets">[</span><span class="hl-brackets">[</span><span class="hl-identifier">key</span><span class="hl-code"> =&gt;|, </span><span class="hl-identifier">value</span><span class="hl-brackets">]</span><span class="hl-code">* </span><span class="hl-brackets">]</span><span class="hl-code"> </span><span class="hl-reserved">or</span><span class="hl-code">
</span><span class="hl-identifier">Hash</span><span class="hl-code">.</span><span class="hl-identifier">new</span><span class="hl-code"> </span><span class="hl-brackets">[</span><span class="hl-reserved">or</span><span class="hl-brackets">]</span><span class="hl-code"> </span><span class="hl-identifier">Hash</span><span class="hl-code">.</span><span class="hl-identifier">new</span><span class="hl-brackets">(</span><span class="hl-identifier">obj</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">[</span><span class="hl-reserved">or</span><span class="hl-brackets">]</span><span class="hl-code">
</span><span class="hl-identifier">Hash</span><span class="hl-code">.</span><span class="hl-identifier">new</span><span class="hl-code"> { |</span><span class="hl-identifier">hash</span><span class="hl-code">, </span><span class="hl-identifier">key</span><span class="hl-code">| </span><span class="hl-identifier">block</span><span class="hl-code"> }</span></div>
</div>
</div>
<p>这将返回一个使用给定对象进行填充的新的哈希。现在，使用创建的对象，我们可以调用任意可用的方法。例如：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-comment">#</span><span class="hl-comment">!/usr/bin/ruby</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-var">$,</span><span class="hl-code"> = </span><span class="hl-quotes">"</span><span class="hl-string">, </span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-identifier">months</span><span class="hl-code"> = </span><span class="hl-identifier">Hash</span><span class="hl-code">.</span><span class="hl-identifier">new</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">month</span><span class="hl-quotes">"</span><span class="hl-code"> </span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">months</span><span class="hl-code"> = {</span><span class="hl-quotes">"</span><span class="hl-string">1</span><span class="hl-quotes">"</span><span class="hl-code"> =&gt; </span><span class="hl-quotes">"</span><span class="hl-string">January</span><span class="hl-quotes">"</span><span class="hl-code">, </span><span class="hl-quotes">"</span><span class="hl-string">2</span><span class="hl-quotes">"</span><span class="hl-code"> =&gt; </span><span class="hl-quotes">"</span><span class="hl-string">February</span><span class="hl-quotes">"</span><span class="hl-code">}
 
</span><span class="hl-identifier">keys</span><span class="hl-code"> = </span><span class="hl-identifier">months</span><span class="hl-code">.</span><span class="hl-identifier">keys</span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">#{keys}</span><span class="hl-quotes">"</span></div>
</div><br/>
<a class="tryitbtn" href="/try/runcode.php?filename=hashobj_demo3&amp;type=ruby" target="_blank">尝试一下 »</a>
</div>
<p>以上实例运行输出结果为：</p>
<pre>
["1", "2"]
</pre>
<p>下面是公共的哈希方法（假设 <i>hash</i> 是一个 Hash 对象）：</p>
<table class="reference">
<tr><th style="width:5%">序号</th><th>方法 &amp; 描述</th></tr>
<tr><td>1</td><td><b>hash == other_hash</b><br>检查两个哈希是否具有相同的键值对个数，键值对是否相互匹配，来判断两个哈希是否相等。</br></td></tr>
<tr><td>2</td><td><b>hash.[key]</b><br>使用键，从哈希引用值。如果未找到键，则返回默认值。</br></td></tr>
<tr><td>3</td><td><b>hash.[key]=value</b><br>把 <i>value</i> 给定的值与 <i>key</i> 给定的键进行关联。</br></td></tr>
<tr><td>4</td><td><b>hash.clear</b><br>从哈希中移除所有的键值对。</br></td></tr>
<tr><td>5</td><td><b>hash.default(key = nil)</b><br/>返回 <i>hash</i> 的默认值，如果未通过 default= 进行设置，则返回 nil。（如果键在 <i>hash</i> 中不存在，则 [] 返回一个默认值。）</td></tr>
<tr><td>6</td><td><b>hash.default = obj</b><br/>为 <i>hash</i> 设置默认值。</td></tr>
<tr><td>7</td><td><b>hash.default_proc</b><br/>如果 <i>hash</i> 通过块来创建，则返回块。</td></tr>
<tr><td>8</td><td><b>hash.delete(key) [or]<br/>
array.delete(key) { |key| block }</b><br/>通过 <i>key</i> 从 <i>hash</i> 中删除键值对。如果使用了块 且未找到匹配的键值对，则返回块的结果。把它与 <i>delete_if</i> 进行比较。</td></tr>
<tr><td>9</td><td><b>hash.delete_if { |key,value| block }</b><br/> block 为 <i>true</i> 的每个块，从 <i>hash</i> 中删除键值对。</td></tr>
<tr><td>10</td><td><b>hash.each { |key,value| block }</b><br/>遍历 <i>hash</i>，为每个 <i>key</i> 调用一次 block，传递 key-value 作为一个二元素数组。</td></tr>
<tr><td>11</td><td><b>hash.each_key { |key| block }</b><br/>遍历 <i>hash</i>，为每个 <i>key</i> 调用一次 block，传递 <i>key</i> 作为参数。</td></tr>
<tr><td>12</td><td><b>hash.each_key { |key_value_array| block }</b><br/>遍历 <i>hash</i>，为每个 <i>key</i> 调用一次 block，传递 <i>key</i> 和 <i>value</i> 作为参数。</td></tr>
<tr><td>13</td><td><b>hash.each_value { |value| block }</b><br/>遍历 <i>hash</i>，为每个 <i>key</i> 调用一次 block，传递 <i>value</i> 作为参数。</td></tr>
<tr><td>14</td><td><b>hash.empty?</b><br/>检查 hash 是否为空（不包含键值对），返回 <i>true</i> 或 <i>false</i>。</td></tr>
<tr><td>15</td><td><b>hash.fetch(key [, default] ) [or]<br/>
hash.fetch(key) { | key | block }</b><br/>通过给定的 <i>key</i> 从 <i>hash</i> 返回值。如果未找到 <i>key</i>，且未提供其他参数，则抛出 <i>IndexError</i> 异常；如果给出了 <i>default</i>，则返回 <i>default</i>；如果指定了可选的 block，则返回 block 的结果。</td></tr>
<tr><td>16</td><td><b>hash.has_key?(key) [or] hash.include?(key) [or]<br/>
hash.key?(key) [or] hash.member?(key)</b><br/>检查给定的 <i>key</i> 是否存在于哈希中，返回 <i>true</i> 或 <i>false</i>。</td></tr>
<tr><td>17</td><td><b>hash.has_value?(value)</b><br/>检查哈希是否包含给定的 <i>value</i>。</td></tr>
<tr><td>18</td><td><b>hash.index(value)</b><br/>为给定的 <i>value</i> 返回哈希中的 <i>key</i>，如果未找到匹配值则返回 <i>nil</i>。</td></tr>
<tr><td>19</td><td><b>hash.indexes(keys)</b><br/>返回一个新的数组，由给定的键的值组成。找不到的键将插入默认值。该方法已被废弃，请使用 select。</td></tr>
<tr><td>20</td><td><b>hash.indices(keys)</b><br/>返回一个新的数组，由给定的键的值组成。找不到的键将插入默认值。该方法已被废弃，请使用 select。</td></tr>
<tr><td>21</td><td><b>hash.inspect</b><br/>返回哈希的打印字符串版本。</td></tr>
<tr><td>22</td><td><b>hash.invert</b><br/>创建一个新的 <i>hash</i>，倒置 <i>hash</i> 中的 <i>keys</i> 和 <i>values</i>。也就是说，在新的哈希中，<i>hash</i> 中的键将变成值，值将变成键。</td></tr>
<tr><td>23</td><td><b>hash.keys</b><br/>创建一个新的数组，带有 <i>hash</i> 中的键。/td&gt;</td></tr>
<tr><td>24</td><td><b>hash.length</b><br/>以整数形式返回 <i>hash</i> 的大小或长度。</td></tr>
<tr><td>25</td><td><b>hash.merge(other_hash) [or]<br/>
hash.merge(other_hash) { |key, oldval, newval| block }</b><br/>返回一个新的哈希，包含 <i>hash</i> 和 <i>other_hash</i> 的内容，重写 hash 中与 <i>other_hash</i> 带有重复键的键值对。</td></tr>
<tr><td>26</td><td><b>hash.merge!(other_hash) [or]<br/>
hash.merge!(other_hash) { |key, oldval, newval| block }</b><br/>与 merge 相同，但实际上 hash 发生了变化。</td></tr>
<tr><td>27</td><td><b>hash.rehash</b><br/>基于每个 <i>key</i> 的当前值重新建立 <i>hash</i>。如果插入后值发生了改变，该方法会重新索引 <i>hash</i>。</td></tr>
<tr><td>28</td><td><b>hash.reject { |key, value| block }</b><br/>
类似 delete_if, 但作用在一个拷贝的哈希上。相等于 hsh.dup.delete_if。
</td></tr>
<tr><td>29</td><td><b>hash.reject! { |key, value| block }</b><br/>相等于 delete_if, 但是如果没有修改，返回 nil。 </td></tr>
<tr><td>30</td><td><b>hash.replace(other_hash)</b><br/>把 <i>hash</i> 的内容替换为 <i>other_hash</i> 的内容。</td></tr>
<tr><td>31</td><td><b>hash.select { |key, value| block }</b><br/>返回一个新的数组，由 <i>block</i> 返回 <i>true</i> 的 <i>hash</i> 中的键值对组成。</td></tr>
<tr><td>32</td><td><b>hash.shift</b><br/>从 <i>hash</i> 中移除一个键值对，并把该键值对作为二元素数组返回。</td></tr>
<tr><td>33</td><td><b>hash.size</b><br/>以整数形式返回 <i>hash</i> 的 <i>size</i> 或 length。</td></tr>
<tr><td>34</td><td><b>hash.sort</b><br/>把 <i>hash</i> 转换为一个包含键值对数组的二维数组，然后进行排序。</td></tr>
<tr><td>35</td><td><b>hash.store(key, value)</b><br/>存储 <i>hash</i> 中的一个键值对。</td></tr>
<tr><td>36</td><td><b>hash.to_a</b><br/>从 hash 中创建一个二维数组。每个键值对转换为一个数组，所有这些数组都存储在一个数组中。</td></tr>
<tr><td>37</td><td><b>hash.to_hash</b><br/>返回 <i>hash</i>（self）。</td></tr>
<tr><td>38</td><td><b>hash.to_s</b><br/>把 <i>hash</i> 转换为一个数组，然后把该数组转换为一个字符串。</td></tr>
<tr><td>39</td><td><b>hash.update(other_hash) [or]<br/>
hash.update(other_hash) {|key, oldval, newval| block}</b><br/>返回一个新的哈希，包含 <i>hash</i> 和 <i>other_hash</i> 的内容，重写 <i>hash</i> 中与 <i>other_hash</i> 带有重复键的键值对。</td></tr>
<tr><td>40</td><td><b>hash.value?(value)</b><br/>检查 <i>hash</i> 是否包含给定的 <i>value</i>。</td></tr>
<tr><td>41</td><td><b>hash.values</b><br/>返回一个新的数组，包含 <i>hash</i> 的所有值。</td></tr>
<tr><td>42</td><td><b>hash.values_at(obj, ...)</b><br/>返回一个新的数组，包含 <i>hash</i> 中与给定的键相关的值。</td></tr>
</table>
</div>