<div class="article-intro" id="content">
<h1>Ruby <span class="color_h1">块</span></h1>
<div class="tutintro">
<p>您已经知道 Ruby 如何定义方法以及您如何调用方法。类似地，Ruby 有一个块的概念。</p>
<ul class="list">
<li>块由大量的代码组成。</li>
<li>您需要给块取个名称。</li>
<li>块中的代码总是包含在大括号 {} 内。</li>
<li>块总是从与其具有相同名称的函数调用。这意味着如果您的块名称为 <i>test</i>，那么您要使用函数 <i>test</i> 来调用这个块。</li>
<li>您可以使用 <i>yield</i> 语句来调用块。</li>
</ul>
</div>
<div class="example">
<h2 class="example">语法</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">block_name</span><span class="hl-code">{
   </span><span class="hl-identifier">statement1</span><span class="hl-code">
</span><span class="hl-identifier">statement2</span><span class="hl-code">
   ..........
}</span></div>
</div>
</div>
<p>在这里，您将学到如何使用一个简单的 <i>yield</i> 语句来调用块。您也将学到如何使用带有参数的 <i>yield</i> 语句来调用块。在实例中，您将看到这两种类型的 <i>yield</i> 语句。</p>
<h2 class="tutheader"><i>yield</i> 语句</h2>
<p>让我们看一个 yield 语句的实例：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-comment">#</span><span class="hl-comment">!/usr/bin/ruby</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-comment">#</span><span class="hl-comment"> -*- coding: UTF-8 -*-</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">test</span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">在 test 方法内</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-reserved">yield</span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">你又回到了 test 方法内</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-reserved">yield</span><span class="hl-code">
</span><span class="hl-reserved">end</span><span class="hl-code">
</span><span class="hl-identifier">test</span><span class="hl-code"> {</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">你在块内</span><span class="hl-quotes">"</span><span class="hl-code">}</span></div>
</div><br/>
<a class="tryitbtn" href="/try/runcode.php?filename=yield_demo&amp;type=ruby" target="_blank">尝试一下 »</a>
</div>
<p>以上实例运行结果为：</p>
<pre>
在 test 方法内
你在块内
你又回到了 test 方法内
你在块内
</pre>
<p>您也可以传递带有参数的 yield 语句。下面是一个实例：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-comment">#</span><span class="hl-comment">!/usr/bin/ruby</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-comment">#</span><span class="hl-comment"> -*- coding: UTF-8 -*-</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">test</span><span class="hl-code">
</span><span class="hl-reserved">yield</span><span class="hl-code"> </span><span class="hl-number">5</span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">在 test 方法内</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-reserved">yield</span><span class="hl-code"> </span><span class="hl-number">100</span><span class="hl-code">
</span><span class="hl-reserved">end</span><span class="hl-code">
</span><span class="hl-identifier">test</span><span class="hl-code"> {|</span><span class="hl-identifier">i</span><span class="hl-code">| </span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">你在块 #{i} 内</span><span class="hl-quotes">"</span><span class="hl-code">}</span></div>
</div><br/>
<a class="tryitbtn" href="/try/runcode.php?filename=yield_demo2&amp;type=ruby" target="_blank">尝试一下 »</a>
</div>
<p>以上实例运行结果为：</p>
<pre>
你在块 5 内
在 test 方法内
你在块 100 内
</pre>
<p>在这里，<i>yield</i> 语句后跟着参数。您甚至可以传递多个参数。在块中，您可以在两个竖线之间放置一个变量来接受参数。因此，在上面的代码中，yield 5 语句向 test 块传递值 5 作为参数。</p>
<p>现在，看下面的语句：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">test</span><span class="hl-code"> {|</span><span class="hl-identifier">i</span><span class="hl-code">| </span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">你在块 #{i} 内</span><span class="hl-quotes">"</span><span class="hl-code">}</span></div>
</div>
</div>
<p>在这里，值 5 会在变量 i 中收到。现在，观察下面的 puts 语句：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">你在块 #{i} 内</span><span class="hl-quotes">"</span></div>
</div>
</div>
<p>这个 puts 语句的输出是：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-code">你在块</span><span class="hl-number">5</span><span class="hl-code"> 内</span></div>
</div>
</div>
<p>如果您想要传递多个参数，那么 <i>yield</i> 语句如下所示：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-reserved">yield</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span class="hl-identifier">b</span></div>
</div>
</div>
<p>此时，块如下所示：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">test</span><span class="hl-code"> {|</span><span class="hl-identifier">a</span><span class="hl-code">, </span><span class="hl-identifier">b</span><span class="hl-code">| </span><span class="hl-identifier">statement</span><span class="hl-code">}</span></div>
</div>
</div>
<p>参数使用逗号分隔。</p>
<h2 class="tutheader">块和方法</h2>
<p>您已经看到块和方法之间是如何相互关联的。您通常使用 yield 语句从与其具有相同名称的方法调用块。因此，代码如下所示：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-comment">#</span><span class="hl-comment">!/usr/bin/ruby</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">test</span><span class="hl-code">
</span><span class="hl-reserved">yield</span><span class="hl-code">
</span><span class="hl-reserved">end</span><span class="hl-code">
</span><span class="hl-identifier">test</span><span class="hl-code">{ </span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">Hello world</span><span class="hl-quotes">"</span><span class="hl-code">}</span></div>
</div>
</div>
<p>本实例是实现块的最简单的方式。您使用 <i>yield</i> 语句调用 test 块。</p>
<p>但是如果方法的最后一个参数前带有 &amp;，那么您可以向该方法传递一个块，且这个块可被赋给最后一个参数。如果 * 和 &amp; 同时出现在参数列表中，&amp; 应放在后面。</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-comment">#</span><span class="hl-comment">!/usr/bin/ruby</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">test</span><span class="hl-brackets">(</span><span class="hl-code">&amp;</span><span class="hl-identifier">block</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">block</span><span class="hl-code">.</span><span class="hl-identifier">call</span><span class="hl-code">
</span><span class="hl-reserved">end</span><span class="hl-code">
</span><span class="hl-identifier">test</span><span class="hl-code"> { </span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">Hello World!</span><span class="hl-quotes">"</span><span class="hl-code">}</span></div>
</div><br/>
<a class="tryitbtn" href="/try/runcode.php?filename=yield_demo3&amp;type=ruby" target="_blank">尝试一下 »</a>
</div>
<p>以上实例运行结果为：</p>
<pre>
Hello World!
</pre>
<h2 class="tutheader">BEGIN 和 END 块</h2>
<p>每个 Ruby 源文件可以声明当文件被加载时要运行的代码块（BEGIN 块），以及程序完成执行后要运行的代码块（END 块）。</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-comment">#</span><span class="hl-comment">!/usr/bin/ruby</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-reserved">BEGIN</span><span class="hl-code"> { 
  </span><span class="hl-comment">#</span><span class="hl-comment"> BEGIN 代码块</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">BEGIN 代码块</span><span class="hl-quotes">"</span><span class="hl-code">
} 
 
</span><span class="hl-reserved">END</span><span class="hl-code"> { 
  </span><span class="hl-comment">#</span><span class="hl-comment"> END 代码块</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">END 代码块</span><span class="hl-quotes">"</span><span class="hl-code">
}
  </span><span class="hl-comment">#</span><span class="hl-comment"> MAIN 代码块</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">puts</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-string">MAIN 代码块</span><span class="hl-quotes">"</span></div>
</div>
</div>
<p>一个程序可以包含多个 BEGIN 和 END 块。BEGIN 块按照它们出现的顺序执行。END 块按照它们出现的相反顺序执行。当执行时，上面的程序输出以下结果：</p>
<pre>
BEGIN 代码块
MAIN 代码块
END 代码块
</pre>
</div>