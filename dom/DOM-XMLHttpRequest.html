<div class="article-intro" id="content">
<h1><span class="color_h1">XMLHttpRequest</span> 对象</h1>
<hr/>
<p class="intro">通过 XMLHttpRequest 对象，您可以在不重新加载整个页面的情况下更新网页中的某个部分。</p>
<hr/>
<h2>XMLHttpRequest 对象</h2>
<p>XMLHttpRequest 对象用于幕后与服务器交换数据。</p>
<p>XMLHttpRequest 对象是<b>开发者的梦想</b>，因为您可以：</p>
<ul>
<li>在不重新加载页面的情况下更新网页</li>
<li>在页面已加载后从服务器请求数据</li>
<li>在页面已加载后从服务器接收数据</li>
<li>在后台向服务器发送数据</li>
</ul>
<hr/>
<h2>创建 XMLHttpRequest 对象</h2>
<p>所有现代的浏览器（IE7+、Firefox、Chrome、Safari 和 Opera）都有一个内建的 XMLHttpRequest 对象。</p>
<p>创建 XMLHttpRequest 对象的语法</p>
<div class="code notranslate"><div>
xmlhttp=new XMLHttpRequest();</div></div>
<p>旧版本的 Internet Explorer（IE5 和 IE6）使用 ActiveX 对象：</p>
<div class="code notranslate"><div>
xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");</div></div>
<p>为了处理所有现代的浏览器，包括 IE5 和 IE6，请检查浏览器是否支持 XMLHttpRequest 对象。如果支持，则创建一个 XMLHttpRequest 对象，如果不支持，则创建一个 ActiveX 对象：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-builtin">window</span><span class="hl-code">.</span><span class="hl-identifier">XMLHttpRequest</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-comment">//</span><span class="hl-comment"> IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">=</span><span class="hl-reserved">new</span><span class="hl-code"> </span><span class="hl-identifier">XMLHttpRequest</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">else</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-comment">//</span><span class="hl-comment"> IE6, IE5 浏览器执行代码</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">=</span><span class="hl-reserved">new</span><span class="hl-code"> </span><span class="hl-identifier">ActiveXObject</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">Microsoft.XMLHTTP</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=try_dom_xmlhttprequest_first" target="_blank">尝试一下 »</a>
</div>
<br/><hr/>
<h2>发送一个请求到服务器</h2>
<p>为了发送一个请求到服务器，我们使用 XMLHttpRequest 对象的 open() 和 send() 方法：</p>
<div class="code notranslate"><div>
xmlhttp.open("GET","xmlhttp_info.txt",true);<br/>
xmlhttp.send();</div></div>
<br/><table class="reference notranslate">
<tr>
<th align="left" width="30%">方法</th>
<th align="left" width="70%">描述</th>
</tr>
<tr>
<td>open(<i>method,url,async</i>)</td>
<td>规定请求的类型，URL，请求是否应该进行异步处理。<br/><br/><i>method</i>：请求的类型：GET 或 POST<br/><i>url</i>：文件在服务器上的位置<br/><i>async</i>：true（异步）或 false（同步）</td>
</tr>
<tr>
<td>send(<i>string</i>)</td>
<td>发送请求到服务器。<br/><br/><i>string</i>：仅用于 POST 请求</td>
</tr>
</table>
<br/><hr/>
<h2>GET 或 POST？</h2>
<p>GET 比 POST 简单并且快速，可用于大多数情况下。</p>
<p>然而，下面的情况下请始终使用 POST 请求：</p>
<ul>
<li>缓存的文件不是一个选项（更新服务器上的文件或数据库）</li>
<li>发送到服务器的数据量较大（POST 没有大小的限制）</li>
<li>发送用户输入（可以包含未知字符），POST 比 GET 更强大更安全</li>
</ul>
<hr/>
<h2>URL - 服务器上的文件</h2>
<p>open() 方法的 url 参数，是一个在服务器上的文件的地址：</p>
<div class="code notranslate"><div>
xmlhttp.open("GET","xmlhttp_info.txt",true);</div></div>
<p>该文件可以是任何类型的文件（如 .txt 和 .xml），或服务器脚本文件（如.html 和 .php，可在发送回响应之前在服务器上执行动作）。</p>
<hr/>
<h2>异步 - True 或 False?</h2>
<p>如需异步发送请求，open() 方法的 async 参数必需设置为 true：</p>
<div class="code"><div>
xmlhttp.open("GET","xmlhttp_info.txt",true);</div></div>
<p>发送异步请求对于 Web 开发人员是一个巨大的进步。在服务器上执行的许多任务非常费时。</p>
<p>通过异步发送，JavaScript 不需要等待服务器的响应，但可以替换为：</p>
<ul>
<li>等待服务器的响应时，执行其他脚本</li>
<li>响应准备时处理响应</li>
</ul>
<hr/>
<h2>Async=true</h2>
<p>当使用 async=true 时，在 onreadystatechange 事件中响应准备时规定一个要执行的函数：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">onreadystatechange</span><span class="hl-code">=</span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">readyState</span><span class="hl-code">==</span><span class="hl-number">4</span><span class="hl-code"> &amp;&amp; </span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">status</span><span class="hl-code">==</span><span class="hl-number">200</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">myDiv</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">responseText</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">GET</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">xmlhttp_info.txt</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-reserved">true</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=try_dom_xmlhttprequest_first" target="_blank">尝试一下 »</a>
</div>
<br/><hr/>
<h2>Async=false</h2>
<p>如需使用 async=false，请更改 open() 方法的第三个参数为 false：</p>
<div class="code notranslate"><div>
xmlhttp.open("GET","xmlhttp_info.txt",false);</div></div>
<p>不推荐使用 async=false，但如果处理几个小的请求还是可以的。</p>
<p>请记住，JavaScript 在服务器响应准备之前不会继续执行。如果服务器正忙或缓慢，应用程序将挂起或停止。</p>
<p><b>注意：</b>当您使用 async=false 时，不要编写 onreadystatechange 
函数 - 只需要把代码放置在 send() 语句之后即可：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">open</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">GET</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-string">xmlhttp_info.txt</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-reserved">false</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">send</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">myDiv</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">responseText</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=try_dom_xmlhttprequest_asyncfalse" target="_blank">尝试一下 »</a>
</div>
<br/><hr/>
<h2>服务器响应</h2>
<p>如需从服务器获取响应，请使用 XMLHttpRequest 对象的 responseText 或 responseXML 属性。</p>
<table class="reference notranslate">
<tr>
<th align="left" width="20%">属性</th>
<th align="left" width="80%">描述</th>
</tr>
<tr>
<td>responseText</td>
<td>获取响应数据作为字符串</td>
</tr>
<tr>
<td>responseXML</td>
<td>ResponseXML 属性返回 XML 文档对象，可使用 DOM 节点树的方法和属性来检查和解析该对象。</td>
</tr>
</table>
<br/><hr/>
<h2>responseText 属性</h2>
<p>如果来自服务器的响应不是 XML，请使用 responseText 属性。</p>
<p>responseText 属性以字符串形式返回响应，您可以相应地使用它：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">myDiv</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">responseText</span><span class="hl-code">;</span></div></div>
<br/><a class="tryitbtn" href="/try/try.php?filename=try_dom_xmlhttprequest_first" target="_blank">尝试一下 »</a>
</div>
<br/><hr/>
<h2>responseXML 属性</h2>
<p>如果来自服务器的响应是 XML，且您想要把它解析为 XML 对象，请使用 responseXML 属性：</p>
<div class="example">
<h2 class="example">实例</h2>
<p>请求文件 <a href="/try/demo_source/cd_catalog.xml" target="_blank">cd_catalog.xml</a> 并解析响应：</p>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlDoc</span><span class="hl-code">=</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">responseXML</span><span class="hl-code">;
</span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">txt</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-quotes">"</span><span class="hl-code">;
</span><span class="hl-identifier">x</span><span class="hl-code">=</span><span class="hl-identifier">xmlDoc</span><span class="hl-code">.</span><span class="hl-identifier">getElementsByTagName</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">ARTIST</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-reserved">for</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">i</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-code">;</span><span class="hl-identifier">i</span><span class="hl-code">&lt;</span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">length</span><span class="hl-code">;</span><span class="hl-identifier">i</span><span class="hl-code">++</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">txt</span><span class="hl-code">=</span><span class="hl-identifier">txt</span><span class="hl-code"> + </span><span class="hl-identifier">x</span><span class="hl-brackets">[</span><span class="hl-identifier">i</span><span class="hl-brackets">]</span><span class="hl-code">.</span><span class="hl-identifier">childNodes</span><span class="hl-brackets">[</span><span class="hl-number">0</span><span class="hl-brackets">]</span><span class="hl-code">.</span><span class="hl-identifier">nodeValue</span><span class="hl-code"> + </span><span class="hl-quotes">"</span><span class="hl-quotes">"</span><span class="hl-code">;
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">myDiv</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-identifier">txt</span><span class="hl-code">;</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=try_dom_xmlhttprequest_responsexml" target="_blank">尝试一下 »</a>
</div>
<br/><hr/>
<h2>onreadystatechange 事件</h2>
<p>当请求被发送到服务器，我们要根据响应执行某些动作。</p>
<p>onreadystatechange 事件在每次 readyState 变化时被触发。</p>
<p>readyState 属性持有 XMLHttpRequest 的状态。</p>
<p>XMLHttpRequest 对象的三个重要的属性：</p>
<table class="reference notranslate">
<tr>
<th align="left" width="20%">属性</th>
<th align="left" width="80%">描述</th>
</tr>
<tr>
<td>onreadystatechange</td>
<td>存储函数（或函数的名称）在每次 readyState 属性变化时被自动调用</td>
</tr>
<tr>
<td>readyState</td>
<td>存放了 XMLHttpRequest 的状态。从 0 到 4 变化：<br/>
	0：请求未初始化<br/>
	1：服务器建立连接<br/>
	2：收到的请求<br/>
	3：处理请求<br/>
	4：请求完成和响应准备就绪</td>
</tr>
<tr>
<td>status</td>
<td>200："OK"<br/>
	404：找不到页面</td>
</tr>
</table>
<p>在 onreadystatechange 事件中，我们规定当服务器的响应准备处理时会发生什么。</p>
<p>当 readyState 是 4 或状态是 200 时，响应准备：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">onreadystatechange</span><span class="hl-code">=</span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">readyState</span><span class="hl-code">==</span><span class="hl-number">4</span><span class="hl-code"> &amp;&amp; </span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">status</span><span class="hl-code">==</span><span class="hl-number">200</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">myDiv</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-identifier">xmlhttp</span><span class="hl-code">.</span><span class="hl-identifier">responseText</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=try_dom_xmlhttprequest_first" target="_blank">尝试一下 »</a>
</div>
<p><b>注意：</b>onreadystatechange 事件在每次 readyState 发生变化时被触发，总共触发了四次。</p>
<hr/>
<div class="tryit_ex">
<img alt="实例s" height="46px" src="/images/tryitimg.gif" width="40"/><h2>更多实例</h2>
</div>
<p>
<a href="/try/try.php?filename=try_dom_xmlhttprequest_header" target="_blank">
通过 getAllResponseHeaders() 检索头信息</a><br/>
检索资源（文件）的头信息。
</p>
<p>
<a href="/try/try.php?filename=try_dom_xmlhttprequest_lastmodified" target="_blank">
通过 getResponseHeader() 检索指定头信息</a><br/>
检索资源（文件）的指定头信息。
</p>
<p>
<a href="/try/try.php?filename=try_dom_xmlhttprequest_suggest" target="_blank">检索 ASP 文件的内容</a><br/>
当用户在输入字段键入字符时，网页如何与 Web 服务器进行通信。
</p>
<p>
<a href="/try/try.php?filename=try_dom_xmlhttprequest_database" target="_blank">从数据库中检索内容</a><br/>
网页如何通过 XMLHttpRequest 对象从数据库中提取信息。
</p>
<p>
<a href="/try/try.php?filename=try_dom_xmlhttprequest_xml" target="_blank">检索 XML 文件的内容</a><br/>
创建一个 XMLHttpRequest 从 XML 文件中检索数据并把数据显示在一个 HTML 表格中。
</p>
<br/>
</div>