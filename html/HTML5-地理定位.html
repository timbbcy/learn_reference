<div class="article-intro" id="content">
<h1>HTML5 <span class="color_h1">Geolocation（地理定位）</span>
</h1>
<hr/>
<p class="intro" id="demo">HTML5 Geolocation（地理定位）用于定位用户的位置。</p>
<hr/>
<h2>定位用户的位置</h2>
<p>HTML5 Geolocation API 用于获得用户的地理位置。</p>
<p>鉴于该特性可能侵犯用户的隐私，除非用户同意，否则用户位置信息是不可用的。</p>
<hr/>
<h2>浏览器支持</h2>
<p>
<img alt="Internet Explorer" height="30" src="/images/compatible_ie.gif" title="Internet Explorer" width="31"/><img alt="Firefox" height="30" src="/images/compatible_firefox.gif" title="Firefox" width="31"/><img alt="Opera" height="30" src="/images/compatible_opera.gif" title="Opera" width="28"/><img alt="Google Chrome" height="30" src="/images/compatible_chrome.gif" title="Google Chrome" width="31"/><img alt="Safari" height="30" src="/images/compatible_safari.gif" title="Safari" width="28"/></p>
<p>Internet Explorer 9+, Firefox, Chrome, Safari 和 Opera 支持Geolocation（地理定位）.</p>
<p><b>注意: </b>Geolocation（地理定位）对于拥有 GPS 的设备，比如 iPhone，地理定位更加精确。</p>
<hr/>
<h2>HTML5 - 使用地理定位</h2>
<p>请使用 getCurrentPosition() 方法来获得用户的位置。</p>
<p>下例是一个简单的地理定位实例，可返回用户位置的经度和纬度:</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-code">=</span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">demo</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">getLocation</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-builtin">navigator</span><span class="hl-code">.</span><span class="hl-identifier">geolocation</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-builtin">navigator</span><span class="hl-code">.</span><span class="hl-identifier">geolocation</span><span class="hl-code">.</span><span class="hl-identifier">getCurrentPosition</span><span class="hl-brackets">(</span><span class="hl-identifier">showPosition</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">else</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">该浏览器不支持获取地理位置。</span><span class="hl-quotes">"</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">showPosition</span><span class="hl-brackets">(</span><span class="hl-identifier">position</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">纬度: </span><span class="hl-quotes">"</span><span class="hl-code"> + </span><span class="hl-identifier">position</span><span class="hl-code">.</span><span class="hl-identifier">coords</span><span class="hl-code">.</span><span class="hl-identifier">latitude</span><span class="hl-code"> + 
    </span><span class="hl-quotes">"</span><span class="hl-string">&lt;br&gt;经度: </span><span class="hl-quotes">"</span><span class="hl-code"> + </span><span class="hl-identifier">position</span><span class="hl-code">.</span><span class="hl-identifier">coords</span><span class="hl-code">.</span><span class="hl-identifier">longitude</span><span class="hl-code">;    
</span><span class="hl-brackets">}</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryhtml5_geolocation" target="_blank">尝试一下  »</a>
</div>
<p>实例解析:</p>
<ul>
<li>检测是否支持地理定位</li>
<li>如果支持，则运行 getCurrentPosition() 方法。如果不支持，则向用户显示一段消息。</li>
<li>如果getCurrentPosition()运行成功，则向参数showPosition中规定的函数返回一个coordinates对象</li>
<li>showPosition() 函数获得并显示经度和纬度</li>
</ul>
<p>上面的例子是一个非常基础的地理定位脚本，不含错误处理。</p>
<hr/>
<h2>处理错误和拒绝</h2>
<p>getCurrentPosition() 方法的第二个参数用于处理错误。它规定当获取用户位置失败时运行的函数：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">showError</span><span class="hl-brackets">(</span><span class="hl-identifier">error</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">switch</span><span class="hl-brackets">(</span><span class="hl-identifier">error</span><span class="hl-code">.</span><span class="hl-identifier">code</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">case</span><span class="hl-code"> </span><span class="hl-identifier">error</span><span class="hl-code">.</span><span class="hl-identifier">PERMISSION_DENIED</span><span class="hl-code">:
            </span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">用户拒绝对获取地理位置的请求。</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-reserved">break</span><span class="hl-code">;
        </span><span class="hl-reserved">case</span><span class="hl-code"> </span><span class="hl-identifier">error</span><span class="hl-code">.</span><span class="hl-identifier">POSITION_UNAVAILABLE</span><span class="hl-code">:
            </span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">位置信息是不可用的。</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-reserved">break</span><span class="hl-code">;
        </span><span class="hl-reserved">case</span><span class="hl-code"> </span><span class="hl-identifier">error</span><span class="hl-code">.</span><span class="hl-identifier">TIMEOUT</span><span class="hl-code">:
            </span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">请求用户地理位置超时。</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-reserved">break</span><span class="hl-code">;
        </span><span class="hl-reserved">case</span><span class="hl-code"> </span><span class="hl-identifier">error</span><span class="hl-code">.</span><span class="hl-identifier">UNKNOWN_ERROR</span><span class="hl-code">:
            </span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">未知错误。</span><span class="hl-quotes">"</span><span class="hl-code">
</span><span class="hl-reserved">break</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryhtml5_geolocation_error" target="_blank">尝试一下  »</a>
</div>
<p>错误代码：</p>
<ul>
<li>Permission denied - 用户不允许地理定位</li>
<li>Position unavailable - 无法获取当前位置</li>
<li>Timeout - 操作超时</li>
</ul>
<hr/>
<h2>在地图中显示结果</h2>
<p>如需在地图中显示结果，您需要访问可使用经纬度的地图服务，比如谷歌地图或百度地图：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">showPosition</span><span class="hl-brackets">(</span><span class="hl-identifier">position</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">latlon</span><span class="hl-code">=</span><span class="hl-identifier">position</span><span class="hl-code">.</span><span class="hl-identifier">coords</span><span class="hl-code">.</span><span class="hl-identifier">latitude</span><span class="hl-code">+</span><span class="hl-quotes">"</span><span class="hl-string">,</span><span class="hl-quotes">"</span><span class="hl-code">+</span><span class="hl-identifier">position</span><span class="hl-code">.</span><span class="hl-identifier">coords</span><span class="hl-code">.</span><span class="hl-identifier">longitude</span><span class="hl-code">;
 
    </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">img_url</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">http://maps.googleapis.com/maps/api/staticmap?center=</span><span class="hl-quotes">"</span><span class="hl-code">
    +</span><span class="hl-identifier">latlon</span><span class="hl-code">+</span><span class="hl-quotes">"</span><span class="hl-string">&amp;zoom=14&amp;size=400x300&amp;sensor=false</span><span class="hl-quotes">"</span><span class="hl-code">;
    </span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">mapholder</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">&lt;img src='</span><span class="hl-quotes">"</span><span class="hl-code">+</span><span class="hl-identifier">img_url</span><span class="hl-code">+</span><span class="hl-quotes">"</span><span class="hl-string">'&gt;</span><span class="hl-quotes">"</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryhtml5_geolocation_map" target="_blank">尝试一下  »</a>
</div>
<p>在上例中，我们使用返回的经纬度数据在谷歌地图中显示位置（使用静态图像）。</p>
<p><a href="/try/try.php?filename=tryhtml5_geolocation_map_script" target="_blank">Google地图脚本</a><br/>
上面的链接向您演示如何使用脚本来显示带有标记、缩放和拖曳选项的交互式地图。</p>
<hr/>
<h2>给定位置的信息</h2>
<p>本页演示的是如何在地图上显示用户的位置。不过，地理定位对于给定位置的信息同样很有用处。</p>
<p>实例:</p>
<ul>
<li>更新本地信息</li>
<li>显示用户周围的兴趣点</li>
<li>交互式车载导航系统 (GPS)</li>
</ul>
<hr/>
<h2>getCurrentPosition() 方法 - 返回数据</h2>
<p>T若成功，则 getCurrentPosition() 方法返回对象。始终会返回 latitude、longitude 以及 accuracy 属性。如果可用，则会返回其他下面的属性。</p>
<table class="reference notranslate">
<tbody><tr>
<th style="width:40%;">属性</th>
<th>描述</th>
</tr>
<tr>
<td>coords.latitude</td>
<td>十进制数的纬度</td>
</tr>
<tr>
<td>coords.longitude</td>
<td>十进制数的经度</td>
</tr>
<tr>
<td>coords.accuracy</td>
<td>位置精度</td>
</tr>
<tr>
<td>coords.altitude</td>
<td>海拔，海平面以上以米计</td>
</tr>
<tr>
<td>coords.altitudeAccuracy</td>
<td>位置的海拔精度</td>
</tr>
<tr>
<td>coords.heading</td>
<td>方向，从正北开始以度计</td>
</tr>
<tr>
<td>coords.speed</td>
<td>速度，以米/每秒计</td>
</tr>
<tr>
<td>timestamp</td>
<td>响应的日期/时间</td>
</tr>
</tbody></table>
<br/><hr/>
<h2>Geolocation 对象 - 其他有趣的方法</h2>
<p>watchPosition() - 返回用户的当前位置，并继续返回用户移动时的更新位置（就像汽车上的 GPS）。</p>
<p>clearWatch() - 停止 watchPosition() 方法</p>
<p>下面的例子展示 watchPosition() 方法。您需要一台精确的 GPS 设备来测试该例（比如 iPhone）： </p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-code">=</span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">getElementById</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">demo</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">getLocation</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-builtin">navigator</span><span class="hl-code">.</span><span class="hl-identifier">geolocation</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-builtin">navigator</span><span class="hl-code">.</span><span class="hl-identifier">geolocation</span><span class="hl-code">.</span><span class="hl-identifier">watchPosition</span><span class="hl-brackets">(</span><span class="hl-identifier">showPosition</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">else</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">该浏览器不支持获取地理位置。</span><span class="hl-quotes">"</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">showPosition</span><span class="hl-brackets">(</span><span class="hl-identifier">position</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">x</span><span class="hl-code">.</span><span class="hl-identifier">innerHTML</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string">纬度: </span><span class="hl-quotes">"</span><span class="hl-code"> + </span><span class="hl-identifier">position</span><span class="hl-code">.</span><span class="hl-identifier">coords</span><span class="hl-code">.</span><span class="hl-identifier">latitude</span><span class="hl-code"> + 
    </span><span class="hl-quotes">"</span><span class="hl-string">&lt;br&gt;经度: </span><span class="hl-quotes">"</span><span class="hl-code"> + </span><span class="hl-identifier">position</span><span class="hl-code">.</span><span class="hl-identifier">coords</span><span class="hl-code">.</span><span class="hl-identifier">longitude</span><span class="hl-code">; 
</span><span class="hl-brackets">}</span></div>
</div>
<br/><a class="tryitbtn" href="/try/try.php?filename=tryhtml5_geolocation_watchposition" target="_blank">尝试一下  »</a>
</div>
</div>