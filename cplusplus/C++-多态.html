<div class="article-intro" id="content">
<h1>C++ <span class="color_h1">多态</span></h1>
<p><b>多态</b>按字面的意思就是多种形态。当类之间存在层次结构，并且类之间是通过继承关联时，就会用到多态。</p>
<p>C++ 多态意味着调用成员函数时，会根据调用函数的对象的类型来执行不同的函数。</p>
<p>下面的实例中，基类 Shape 被派生为两个类，如下所示：</p>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-prepro">#include</span><span class="hl-prepro"> </span><span class="hl-quotes">&lt;</span><span class="hl-string">iostream</span><span class="hl-quotes">&gt;</span><span class="hl-prepro"> </span><span class="hl-prepro"></span><span class="hl-code">
</span><span class="hl-reserved">using</span><span class="hl-code"> </span><span class="hl-types">namespace</span><span class="hl-code"> </span><span class="hl-identifier">std</span><span class="hl-code">;
 
</span><span class="hl-types">class</span><span class="hl-code"> </span><span class="hl-identifier">Shape</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">protected</span><span class="hl-code">:
      </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">width</span><span class="hl-code">, </span><span class="hl-identifier">height</span><span class="hl-code">;
   </span><span class="hl-reserved">public</span><span class="hl-code">:
      </span><span class="hl-identifier">Shape</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-code">, </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">width</span><span class="hl-code"> = </span><span class="hl-identifier">a</span><span class="hl-code">;
         </span><span class="hl-identifier">height</span><span class="hl-code"> = </span><span class="hl-identifier">b</span><span class="hl-code">;
      </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">area</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">cout</span><span class="hl-code"> &lt;&lt; </span><span class="hl-quotes">"</span><span class="hl-string">Parent class area :</span><span class="hl-quotes">"</span><span class="hl-code"> &lt;&lt;</span><span class="hl-identifier">endl</span><span class="hl-code">;
         </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-number">0</span><span class="hl-code">;
      </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">;
</span><span class="hl-types">class</span><span class="hl-code"> </span><span class="hl-identifier">Rectangle</span><span class="hl-code">: </span><span class="hl-reserved">public</span><span class="hl-code"> </span><span class="hl-identifier">Shape</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">public</span><span class="hl-code">:
      </span><span class="hl-identifier">Rectangle</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-code">, </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code">:</span><span class="hl-identifier">Shape</span><span class="hl-brackets">(</span><span class="hl-identifier">a</span><span class="hl-code">, </span><span class="hl-identifier">b</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">area</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">cout</span><span class="hl-code"> &lt;&lt; </span><span class="hl-quotes">"</span><span class="hl-string">Rectangle class area :</span><span class="hl-quotes">"</span><span class="hl-code"> &lt;&lt;</span><span class="hl-identifier">endl</span><span class="hl-code">;
         </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">width</span><span class="hl-code"> * </span><span class="hl-identifier">height</span><span class="hl-brackets">)</span><span class="hl-code">; 
      </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">;
</span><span class="hl-types">class</span><span class="hl-code"> </span><span class="hl-identifier">Triangle</span><span class="hl-code">: </span><span class="hl-reserved">public</span><span class="hl-code"> </span><span class="hl-identifier">Shape</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">public</span><span class="hl-code">:
      </span><span class="hl-identifier">Triangle</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-code">, </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code">:</span><span class="hl-identifier">Shape</span><span class="hl-brackets">(</span><span class="hl-identifier">a</span><span class="hl-code">, </span><span class="hl-identifier">b</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">area</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">cout</span><span class="hl-code"> &lt;&lt; </span><span class="hl-quotes">"</span><span class="hl-string">Triangle class area :</span><span class="hl-quotes">"</span><span class="hl-code"> &lt;&lt;</span><span class="hl-identifier">endl</span><span class="hl-code">;
         </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">width</span><span class="hl-code"> * </span><span class="hl-identifier">height</span><span class="hl-code"> / </span><span class="hl-number">2</span><span class="hl-brackets">)</span><span class="hl-code">; 
      </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">;
</span><span class="hl-comment">// 程序的主函数</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">main</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">Shape</span><span class="hl-code"> *</span><span class="hl-identifier">shape</span><span class="hl-code">;
   </span><span class="hl-identifier">Rectangle</span><span class="hl-code"> </span><span class="hl-identifier">rec</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-code">,</span><span class="hl-number">7</span><span class="hl-brackets">)</span><span class="hl-code">;
   </span><span class="hl-identifier">Triangle</span><span class="hl-code"> </span><span class="hl-identifier">tri</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-code">,</span><span class="hl-number">5</span><span class="hl-brackets">)</span><span class="hl-code">;
 
   </span><span class="hl-comment">// 存储矩形的地址</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">shape</span><span class="hl-code"> = &amp;</span><span class="hl-identifier">rec</span><span class="hl-code">;
   </span><span class="hl-comment">// 调用矩形的求面积函数 area</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">shape</span><span class="hl-code">-&gt;</span><span class="hl-identifier">area</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
 
   </span><span class="hl-comment">// 存储三角形的地址</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">shape</span><span class="hl-code"> = &amp;</span><span class="hl-identifier">tri</span><span class="hl-code">;
   </span><span class="hl-comment">// 调用三角形的求面积函数 area</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-identifier">shape</span><span class="hl-code">-&gt;</span><span class="hl-identifier">area</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
   
   </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-number">0</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></div>
</div>
</div>
<p>当上面的代码被编译和执行时，它会产生下列结果：</p>
<pre>
Parent class area
Parent class area
</pre>
<p>导致错误输出的原因是，调用函数 area() 被编译器设置为基类中的版本，这就是所谓的<b>静态多态</b>，或<b>静态链接</b> - 函数调用在程序执行前就准备好了。有时候这也被称为<b>早绑定</b>，因为 area() 函数在程序编译期间就已经设置好了。</p>
<p>但现在，让我们对程序稍作修改，在 Shape 类中，area() 的声明前放置关键字 <b>virtual</b>，如下所示：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-types">class</span><span class="hl-code"> </span><span class="hl-identifier">Shape</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">protected</span><span class="hl-code">:
      </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">width</span><span class="hl-code">, </span><span class="hl-identifier">height</span><span class="hl-code">;
   </span><span class="hl-reserved">public</span><span class="hl-code">:
      </span><span class="hl-identifier">Shape</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-code">, </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">width</span><span class="hl-code"> = </span><span class="hl-identifier">a</span><span class="hl-code">;
         </span><span class="hl-identifier">height</span><span class="hl-code"> = </span><span class="hl-identifier">b</span><span class="hl-code">;
      </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-types">virtual</span><span class="hl-code"> </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">area</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">cout</span><span class="hl-code"> &lt;&lt; </span><span class="hl-quotes">"</span><span class="hl-string">Parent class area :</span><span class="hl-quotes">"</span><span class="hl-code"> &lt;&lt;</span><span class="hl-identifier">endl</span><span class="hl-code">;
         </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-number">0</span><span class="hl-code">;
      </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">;</span></div>
</div>
</div>
<p>修改后，当编译和执行前面的实例代码时，它会产生以下结果：</p>
<pre>
Rectangle class area
Triangle class area
</pre>
<p>此时，编译器看的是指针的内容，而不是它的类型。因此，由于 tri 和 rec 类的对象的地址存储在 *shape 中，所以会调用各自的 area() 函数。</p>
<p>正如您所看到的，每个子类都有一个函数 area() 的独立实现。这就是<b>多态</b>的一般使用方式。有了多态，您可以有多个不同的类，都带有同一个名称但具有不同实现的函数，函数的参数甚至可以是相同的。</p>
<h2 class="tutheader">虚函数</h2>
<p><b>虚函数</b> 是在基类中使用关键字 <b>virtual</b> 声明的函数。在派生类中重新定义基类中定义的虚函数时，会告诉编译器不要静态链接到该函数。</p>
<p>我们想要的是在程序中任意点可以根据所调用的对象类型来选择调用的函数，这种操作被称为<b>动态链接</b>，或<b>后期绑定</b>。</p>
<h2 class="tutheader">纯虚函数</h2>
<p>您可能想要在基类中定义虚函数，以便在派生类中重新定义该函数更好地适用于对象，但是您在基类中又不能对虚函数给出有意义的实现，这个时候就会用到纯虚函数。</p>
<p>我们可以把基类中的虚函数 area() 改写如下：</p>
<div class="example">
<div class="example_code">
<div class="hl-main"><span class="hl-types">class</span><span class="hl-code"> </span><span class="hl-identifier">Shape</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">protected</span><span class="hl-code">:
      </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">width</span><span class="hl-code">, </span><span class="hl-identifier">height</span><span class="hl-code">;
   </span><span class="hl-reserved">public</span><span class="hl-code">:
      </span><span class="hl-identifier">Shape</span><span class="hl-brackets">(</span><span class="hl-code"> </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-code">, </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">width</span><span class="hl-code"> = </span><span class="hl-identifier">a</span><span class="hl-code">;
         </span><span class="hl-identifier">height</span><span class="hl-code"> = </span><span class="hl-identifier">b</span><span class="hl-code">;
      </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-comment">// pure virtual function</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-types">virtual</span><span class="hl-code"> </span><span class="hl-types">int</span><span class="hl-code"> </span><span class="hl-identifier">area</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> = </span><span class="hl-number">0</span><span class="hl-code">;
</span><span class="hl-brackets">}</span><span class="hl-code">;</span></div>
</div>
</div>
<p>= 0 告诉编译器，函数没有主体，上面的虚函数是<b>纯虚函数</b>。</p>
</div>