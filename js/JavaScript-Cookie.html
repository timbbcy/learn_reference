<div class="article-intro" id="content">
<h1>JavaScript <span class="color_h1">Cookie</span></h1>
<script>
function displayCookies()
{
var fname=getCookie("firstname");
if (fname==null) {fname="";}
if (fname!="") {fname="firstname="+fname;}
var lname=getCookie("lastname");
if (lname==null) {lname="";}
if (lname!="") {lname="; lastname="+lname;}
alert (fname + lname);
}
function getCookie(name)
{
var nameEQ = name + "=";
var ca = document.cookie.split(';');
for(var i=0;i < ca.length;i++) {
var c = ca[i].trim();
if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
}
return null;
} 
</script>
<hr/>
<p class="intro">Cookie 用于存储 web 页面的用户信息。</p>
<hr/>
<h2>什么是 Cookie？</h2>
<p>Cookie 是一些数据, 存储于你电脑上的文本文件中。</p>
<p>当 web 服务器向浏览器发送 web 页面时，在连接关闭后，服务端不会记录用户的信息。</p>
<p>Cookie 的作用就是用于解决 "如何记录客户端的用户信息":</p>
<ul>
<li>当用户访问 web 页面时，他的名字可以记录在 cookie 中。</li>
<li>在用户下一次访问该页面时，可以在 cookie 中读取用户访问记录。</li>
</ul>
<p>Cookie 以名/值对形式存储，如下所示:</p>
<div class="code">
<div>
username=John Doe
</div>
</div>
<p>当浏览器从服务器上请求 web 页面时， 属于该页面的 cookie 会被添加到该请求中。服务端通过这种方式来获取用户的信息。</p>
<hr/>
<h2>使用 JavaScript 创建Cookie</h2>
<p>JavaScript 可以使用 <strong>document.cookie</strong> 属性来创建 、读取、及删除 cookie。</p>
<p>JavaScript 中，创建 cookie 如下所示：</p>
<div class="code">
<div>
document.cookie="username=John Doe";</div>
</div>
<p>您还可以为 cookie 添加一个过期时间（以 UTC 或 GMT 时间）。默认情况下，cookie 在浏览器关闭时删除：</p>
<div class="code">
<div>
document.cookie="username=John Doe; expires=Thu, 18 Dec 2013 12:00:00 GMT";</div>
</div>
<p>您可以使用 path 参数告诉浏览器 cookie 的路径。默认情况下，cookie 属于当前页面。
</p>
<div class="code">
<div>
document.cookie="username=John Doe; expires=Thu, 18 Dec 2013 12:00:00 GMT; path=/";</div>
</div>
<hr/>
<h2>使用 JavaScript 读取 Cookie</h2>
<p>在 JavaScript 中, 可以使用以下代码来读取 cookie：</p>
<div class="code notranslate">
<div>
var x = document.cookie;</div>
</div>
<br/>
<table class="lamp"><tbody><tr>
<th style="width:34px"><img alt="Note" src="/images/lamp.jpg" style="height:32px;width:32px"/></th>
<td>document.cookie 将以字符串的方式返回所有的 cookie，类型格式： cookie1=value; cookie2=value; cookie3=value;</td>
</tr></tbody></table>
<br/>
<hr/>
<h2>使用 JavaScript 修改 Cookie</h2>
<p>在 JavaScript 中，修改 cookie 类似于创建 cookie，如下所示：</p>
<div class="code">
<div>
document.cookie="username=John Smith; expires=Thu, 18 Dec 2013 12:00:00 GMT; path=/";</div>
</div>
<p>旧的 cookie 将被覆盖。</p>
<hr/>
<h2>使用 JavaScript 删除 Cookie</h2>
<p>删除 cookie 非常简单。您只需要设置 expires 参数为以前的时间即可，如下所示，设置为 Thu, 01 Jan 1970 00:00:00 GMT:</p>
<div class="code notranslate">
<div>
document.cookie = "username=; expires=Thu, 01 
Jan 1970 00:00:00 GMT";
</div>
</div>
<p>注意，当您删除时不必指定 cookie 的值。</p>
<hr/>
<h2>Cookie 字符串</h2>
<p>document.cookie 属性看起来像一个普通的文本字符串，其实它不是。</p>
<p>即使您在 document.cookie 中写入一个完整的 cookie 字符串, 当您重新读取该 cookie 信息时，cookie 信息是以名/值对的形式展示的。</p>
<p>如果您设置了新的 cookie，旧的 cookie 不会被覆盖。
新 cookie 将添加到 document.cookie 中，所以如果您重新读取document.cookie，您将获得如下所示的数据：</p>
<p>cookie1=value; cookie2=value;</p>
<p>
<button onclick="displayCookies();" type="button">显示所有 Cookie</button> 
<button onclick="document.cookie='firstname=John'" type="button">创建 Cookie 1</button> 
<button onclick="document.cookie='lastname=Smith'" type="button">创建 Cookie 2</button>
<button onclick="document.cookie='firstname=John;expires=Thu, 01 Jan 1970 00:00:00 GMT'" type="button">删除 Cookie 1</button> 
<button onclick="document.cookie='lastname=Smith;expires=Thu, 01 Jan 1970 00:00:00 GMT'" type="button">删除 Cookie 2</button>
</p>
<p>如果您需要查找一个指定 cookie 值，您必须创建一个JavaScript 函数在 cookie 字符串中查找 cookie 值。</p>
<hr/>
<h2>JavaScript Cookie 实例</h2>
<p>在以下实例中，我们将创建 cookie 来存储访问者名称。</p>
<p>首先，访问者访问 web 页面, 他将被要求填写自己的名字。该名字会存储在 cookie 中。</p>
<p>访问者下一次访问页面时，他会看到一个欢迎的消息。</p>
<p>在这个实例中我们会创建 3 个 JavaScript 函数:</p>
<ol>
<li>设置 cookie 值的函数</li>
<li>获取 cookie 值的函数</li>
<li>检测 cookie 值的函数</li>
</ol>
<hr/>
<h2>设置 cookie 值的函数</h2>
<p>首先，我们创建一个函数用于存储访问者的名字：</p>
<pre>
function setCookie(cname,cvalue,exdays)
{
  var d = new Date();
  d.setTime(d.getTime()+(exdays*24*60*60*1000));
  var expires = "expires="+d.toGMTString();
  document.cookie = cname + "=" + cvalue + "; " + expires;
}
</pre>
<p><strong>函数解析：</strong></p>
<p>以上的函数参数中，cookie 的名称为 cname，cookie 的值为 cvalue，并设置了 cookie 的过期时间 expires。</p>
<p>该函数设置了 cookie 名、cookie 值、cookie过期时间。</p>
<hr/>
<h2>获取 cookie 值的函数</h2>
<p>然后，我们创建一个函数用户返回指定 cookie 的值：</p>
<pre>
function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i&lt;ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}
</pre>
<p><strong>函数解析：</strong></p>
<p>cookie 名的参数为 cname。</p>
<p>创建一个文本变量用于检索指定 cookie :cname + "="。</p>
<p>使用分号来分割 document.cookie 字符串，并将分割后的字符串数组赋值给 ca (ca = document.cookie.split(';'))。</p>
<p>循环 ca 数组 (i=0;i&lt;ca.length;i++)，然后读取数组中的每个值，并去除前后空格 (c=ca[i].trim())。</p>
<p>如果找到 cookie(c.indexOf(name) == 0)，返回 cookie 的值 (c.substring(name.length,c.length)。</p>
<p>如果没有找到 cookie, 返回 ""。</p>
<hr/>
<h2>检测 cookie 值的函数</h2>
<p>最后，我们可以创建一个检测 cookie 是否创建的函数。</p>
<p>如果设置了 cookie，将显示一个问候信息。</p>
<p>如果没有设置 cookie，将会显示一个弹窗用于询问访问者的名字，并调用 setCookie 函数将访问者的名字存储 365 天：</p>
<pre>
function checkCookie()
{
  var username=getCookie("username");
  if (username!="")
  {
    alert("Welcome again " + username);
  }
  else 
  {
    username = prompt("Please enter your name:","");
    if (username!="" &amp;&amp; username!=null)
    {
      setCookie("username",username,365);
    }
  }
}
</pre>
<br/>
<hr/>
<h2>完整实例</h2>
<div class="example">
<h2 class="example">实例</h2>
<div class="example_code">
<div class="hl-main"><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">setCookie</span><span class="hl-brackets">(</span><span class="hl-identifier">cname</span><span class="hl-code">,</span><span class="hl-identifier">cvalue</span><span class="hl-code">,</span><span class="hl-identifier">exdays</span><span class="hl-brackets">)</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-code"> = </span><span class="hl-reserved">new</span><span class="hl-code"> </span><span class="hl-builtin">Date</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">d</span><span class="hl-code">.</span><span class="hl-identifier">setTime</span><span class="hl-brackets">(</span><span class="hl-identifier">d</span><span class="hl-code">.</span><span class="hl-identifier">getTime</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">+</span><span class="hl-brackets">(</span><span class="hl-identifier">exdays</span><span class="hl-code">*</span><span class="hl-number">24</span><span class="hl-code">*</span><span class="hl-number">60</span><span class="hl-code">*</span><span class="hl-number">60</span><span class="hl-code">*</span><span class="hl-number">1000</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">expires</span><span class="hl-code"> = </span><span class="hl-quotes">"</span><span class="hl-string">expires=</span><span class="hl-quotes">"</span><span class="hl-code">+</span><span class="hl-identifier">d</span><span class="hl-code">.</span><span class="hl-identifier">toGMTString</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">cookie</span><span class="hl-code"> = </span><span class="hl-identifier">cname</span><span class="hl-code">+</span><span class="hl-quotes">"</span><span class="hl-string">=</span><span class="hl-quotes">"</span><span class="hl-code">+</span><span class="hl-identifier">cvalue</span><span class="hl-code">+</span><span class="hl-quotes">"</span><span class="hl-string">; </span><span class="hl-quotes">"</span><span class="hl-code">+</span><span class="hl-identifier">expires</span><span class="hl-code">;
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">getCookie</span><span class="hl-brackets">(</span><span class="hl-identifier">cname</span><span class="hl-brackets">)</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">name</span><span class="hl-code"> = </span><span class="hl-identifier">cname</span><span class="hl-code"> + </span><span class="hl-quotes">"</span><span class="hl-string">=</span><span class="hl-quotes">"</span><span class="hl-code">;
    </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">ca</span><span class="hl-code"> = </span><span class="hl-builtin">document</span><span class="hl-code">.</span><span class="hl-identifier">cookie</span><span class="hl-code">.</span><span class="hl-identifier">split</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">;</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-reserved">for</span><span class="hl-brackets">(</span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">i</span><span class="hl-code">=</span><span class="hl-number">0</span><span class="hl-code">; </span><span class="hl-identifier">i</span><span class="hl-code">&lt;</span><span class="hl-identifier">ca</span><span class="hl-code">.</span><span class="hl-identifier">length</span><span class="hl-code">; </span><span class="hl-identifier">i</span><span class="hl-code">++</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code"> = </span><span class="hl-identifier">ca</span><span class="hl-brackets">[</span><span class="hl-identifier">i</span><span class="hl-brackets">]</span><span class="hl-code">.</span><span class="hl-identifier">trim</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">c</span><span class="hl-code">.</span><span class="hl-identifier">indexOf</span><span class="hl-brackets">(</span><span class="hl-identifier">name</span><span class="hl-brackets">)</span><span class="hl-code">==</span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">.</span><span class="hl-identifier">substring</span><span class="hl-brackets">(</span><span class="hl-identifier">name</span><span class="hl-code">.</span><span class="hl-identifier">length</span><span class="hl-code">,</span><span class="hl-identifier">c</span><span class="hl-code">.</span><span class="hl-identifier">length</span><span class="hl-brackets">)</span><span class="hl-code">; </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-quotes">"</span><span class="hl-quotes">"</span><span class="hl-code">;
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-identifier">checkCookie</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">user</span><span class="hl-code">=</span><span class="hl-identifier">getCookie</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">username</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">user</span><span class="hl-code">!=</span><span class="hl-quotes">"</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">alert</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">欢迎 </span><span class="hl-quotes">"</span><span class="hl-code"> + </span><span class="hl-identifier">user</span><span class="hl-code"> + </span><span class="hl-quotes">"</span><span class="hl-string"> 再次访问</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-reserved">else</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">user</span><span class="hl-code"> = </span><span class="hl-identifier">prompt</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">请输入你的名字:</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-quotes">"</span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">;
          </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">user</span><span class="hl-code">!=</span><span class="hl-quotes">"</span><span class="hl-quotes">"</span><span class="hl-code"> &amp;&amp; </span><span class="hl-identifier">user</span><span class="hl-code">!=</span><span class="hl-reserved">null</span><span class="hl-brackets">)</span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-identifier">setCookie</span><span class="hl-brackets">(</span><span class="hl-quotes">"</span><span class="hl-string">username</span><span class="hl-quotes">"</span><span class="hl-code">,</span><span class="hl-identifier">user</span><span class="hl-code">,</span><span class="hl-number">30</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span></div>
</div>
<br/><a class="tryitbtn" href="/try/tryit.php?filename=tryjs_cookie_username" target="_blank">尝试一下 »</a>
</div>
<p>以下实例在页面载入时执行 checkCookie() 函数。</p>
</div>